pico-8 cartridge // http://www.pico-8.com
version 32
__lua__
function _init()
	things={}
	spawn_x=64
	spawn_y=120
	spawn_v=10
	gravity=1
	angle=.25
	sides=3
	thisvert=1	
	max_age=50
end

function draw_shooter()
	local x1=spawn_x
	local y1=spawn_y
	local x2=x1+spawn_v*cos(angle)
	local y2=y1+spawn_v*sin(angle)
	local xl=x1+spawn_v*.5*cos(angle+.375)
	local yl=y1+spawn_v*.5*sin(angle+.375)
	local xr=x1+spawn_v*.5*cos(angle-.375)
	local yr=y1+spawn_v*.5*sin(angle-.375)
	
	
	trifill({x1,y1,x2,y2,xl,yl},8)
	trifill({x1,y1,x2,y2,xr,yr},2)


end

function _draw()
	cls()
//	test()
	
	print("sides:"..sides,0,0,7)

	print("‚¨ÖÔ∏è‚û°Ô∏è angle",7)
	print("‚¨ÜÔ∏è‚¨áÔ∏è power",7)
	print("üÖæÔ∏è shape",7) 
	print("‚ùé shoot",7)
	
	
	for thing in all(things) do
		local x=thing.x
		local y=thing.y
		local z=thing.z
		local r=thing.r
		local col=thing.col
		//circfill(thing.x,thing.y,thing.z,thing.col)
		polyfill(x,y,sides,z,r,col)
	end
	
	draw_shooter()

end

function _update()
	update_shoot()
end

function update_shoot()
	if btnp(‚ùé) then
		spawn(10)
	end
	if btnp(üÖæÔ∏è) then
		sides+=1
	end
	if btn(‚¨ÖÔ∏è) and angle<0.5 then
		angle+=.01
	end
	if btn(‚û°Ô∏è) and angle>0 then
		angle-=.01
	end
	if btn(‚¨ÜÔ∏è) and spawn_v < 20 then
		spawn_v+=.5
	end
	if btn(‚¨áÔ∏è) and spawn_v > 5 then
		spawn_v-=.5
	end
	
	for thing in all(things) do
		--bounce
		if thing.y>128-thing.z
		 and thing.dy > 0 then
			thing.dy=-.8*thing.dy
		end

		thing.x+=thing.dx
		thing.y+=thing.dy
		thing.z+=thing.dz
		thing.dy+=gravity
		thing.r+=thing.dr
		thing.age+=1
		if thing.age>max_age then
			del(things,thing)
		end
	end
end

water={1,6,7,12}
fire={2,8,9,10,7}

function spawn(num)
	for i=0,num do
	
		dev_a=angle+rnd(.02)-.02
		dev_v=spawn_v+rnd(4)-2
		
		add(things, { 
					x=spawn_x,
					y=spawn_y,
					z=5,
					dx=dev_v*cos(dev_a),
					dy=dev_v*sin(dev_a),
					dz=rnd(1)-.5,
					r=rnd(.25),
					dr=-.1*cos(dev_a),
					col=flr(rnd(15))+1,
					age=0
			})
	end
	sfx(0)
end


function polyfill(x,y,sides,size,r,col)
	local rot={} //vertex rotations
	for i=0,sides do
		add(rot,r+i/sides)
	end

	verts={} //vertex coords
	for r in all(rot) do
		local x1=x+size*cos(r)
		local y1=y+size*sin(r)
		local x2=x+size*cos(r+1/sides)
		local y2=y+size*sin(r+1/sides)

		trifill({x,y,x1,y1,x2,y2},col)
	end
	
end

function sqr(x,y,size,r,col)
	local r0=r
	local r1=r+0.25
	local r2=r+0.5
	local r3=r+0.75
	x1=x+size*cos(r0)
	y1=y+size*sin(r0)
	x2=x+size*cos(r1)
	y2=y+size*sin(r1)
	x3=x+size*cos(r2)
	y3=y+size*sin(r2)
	x4=x+size*cos(r3)
	y4=y+size*sin(r3)
	line(x1,y1,x2,y2,col)
	line(x2,y2,x3,y3,col)
	line(x3,y3,x4,y4,col)
	line(x4,y4,x1,y1,col)
end


-->8
--trifill
function trifill(vertices,col)
	//need to find lua copy fn
	local tvertices={
		vertices[1],
		vertices[2],
		vertices[3],
		vertices[4],
		vertices[5],
		vertices[6],
		}
	
	v_sort(tvertices)
	
	local x1=tvertices[1]
	local y1=tvertices[2]
	local x2=tvertices[3]
	local	y2=tvertices[4]
	local x3=tvertices[5]
	local y3=tvertices[6]
	
	if y2-y1>0 then
		dx1=(x2-x1)/(y2-y1)
	else dx1=0 end
	if y3-y1>0 then
		dx2=(x3-x1)/(y3-y1)
	else dx2=0 end
	if y3-y2>0 then
		dx3=(x3-x2)/(y3-y2)
	else dx3=0 end

	if dx1>dx2 then
		for i=0,y2-y1 do
			local y=y1+i
			local xs=x1+dx2*i
			line(xs,y,x1+dx1*i,y,col)	
		end
		for i=0,y3-y2 do
			local y=y2+i
			local xs=x1+dx2*(y-y1)
			line(xs,y,x2+dx3*i,y,col)
		end
	else // dx1<=dx2
		for i=0,y2-y1 do
			local y=i+y1
			local xa=x1+dx1*i
			local xb=x1+dx2*i
			line(xa,y,xb,y,col)
		end
		for i=0,y3-y2 do
			local y=i+y2
			local xa=x2+i*dx3
			local xb=x1+dx2*(y-y1)
			line (xa,y,xb,y,col)
		end
	end
end

//sort vertex tables by y
function v_sort(a)
	for i=2,#a,2 do
		local j=i
		while j>2 and a[j-2] > a[j] do
			a[j],a[j-2] = a[j-2],a[j]
			a[j-1],a[j-3] = a[j-3],a[j-1]
			j-=2
		end	
	end
end


__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
0770777077007770077000007770000000000000000000000000000033333333333000ee07777777777777770000000000000000000000000000000000000000
70000700707070007000070000700000000000000000000000000000f33333333330000007777777777777700000000000000000000000000000000000000000
77700700707077007770000007700000000000000000000000000000ff3333333300000007d77777777770000000000000000000000000000000000000000000
007007007070700000700700007000000000000000000000000000999999933333000000ddd77777777000000000000000000000000000000000000000000000
7700777077707770770000007770000000000000000000000000000999993333300000000dd77777770000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000009999933333c00000007777777000000000000000000000000000000000000000000000000
07777700077777000000777077000770700077700000000000000000999003330cc0000007177711100000000000000000000000000000000000000000000000
7770077077007770000070707070700070007000000000000000000009900333ccc0000111171111100000000000000000000000000000000000000000000000
770007707700077000007770707070007000770000000000000000000900003ccccc111111111100000000000000000000000000000000000000000000000000
77700770770077700000707070707070700070000000000000000000000000cccccc111111000000000000000000000000000000000000000000000000000000
07777700077777000000707070707770777077700000000009000000000000cccccc111111000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000099900000000000cccccccc11111000000000000000000000000000000000000000000000000000000
077777000777770000007770077070707770777000000000000000000000ccccccccc00111000000000000000000000000000000000000000000000000000000
77707770770007700000707070707070700070700000000000000000000ccccccccccc0010000000000000000000000000000000000000000000000000000000
77000770770007700000777070707070770077000000000000000000000ccccccccccc0000000000000000000000000000000000000000000000000000000000
7700077077707770000070007070777070007070000000000000000000c3cccccccccc0000000000000000000000000000000000000000000000000000000000
077777000777770000007000770077707770707000000000000000000333ccccccccccc900000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000003333ccccccccccc990000100600000000000000000000000000000000000000000000000
07777700000007707070777077707770000000000000000000000033333300333ccccccc99911666600000000000000000000000000000000000000000000000
770007700000700070707070707070000000000000000000000033333333003333e9999c99999666600000000000000000000000000000000000000000000000
77070770000077707770777077707700000000000000000000033333333300333339999999912666333300000000000000000000000000000000000000000000
770007700000007070707070700070000000000000000000033333333333bb033339999992222666333333333300000000000000000000000000000000000000
077777000000770070707070700077700000000000000000333333333333bbbbb339992222222666333333333300000000000000000000000000000000000000
000000000000000000000000000000000000000000000000003333333333bbbbbbbbb22222226663333333333000000000000000000000000000000000000000
077777000000077070700770077077700000000000000001111133333333bbbbbbbb222222226663333333330000000000000000000000000000000000000000
770707700000700070707070707007000000000000000000111999333333bbbbbbb2222222226633333333300000000000000000000000000000000000000000
777077700000777077707070707007000000000000000000011999993333bbbbb222222222226633333333000000000000000000000000000000000000000000
770707700000007070707070707007000000000000000000011999990033bbbb2222222222266633333330000000000000000000000000000000000000000000
0777770000007700707077007700070000000000000000000009999990bbbbb22222222222266333333300000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000099000000bbbbee2222222222266333333000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000bbee777777777777773333330000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000060000000bbee777777777777733333300000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000666666ebbbbee77777777777733333300000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000666eeebbbbbee7999999999333333000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000066eeebbbbbbbe7999999997333330000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000666ebbbbbbbbe799999992333399999999999000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000006666bbeeeeeee79999997d333999999999990000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000006666666eeeeee799d99dddfd999999999900000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000666666666eeff799dddfffddddd999999000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000006666666600eff79dddfffddddddd9999000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000066666666000fff9ddfffddddddddddd0000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000066666600b00ff77ffffddddddddddddd00000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000066666000bbbfffffffddddddddddddddddd00000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000006666000bbbbbfffffdddddddddddddddddd0000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000066600001bbbbbbffdddddddddddddddddb00000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000006000011bbbbbbbfddddddddddddddddbbb0000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000001111bbbbbbbbddddddddddddddbbbb0000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000bbbbbbbbbbbbbddddddddddbbbbb0000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000c0000bbbbbbbbbbbdddddddddddbbbbbb0000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000cc000bbbbbbbbb9ddddddddddabbbbbbb0000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000ccc000bbbbbbbb99dddddddddaabbbbbbbb000000000000000000000000000000000000
00000000000000000000000000000000000000000000000bbbbbbbbbbccccbbbbbbbbddd9ddddddddbbbbbbbbbbb000000000000000000000000000000000000
000000000000000000000000000000000000000000000000bbbbbbbbbbbbbbbbbbbdddddddddddddbbbbbbbbbbbb000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000bbbbbbbbbbbbbbbbdddddddddddddd00bbbbbbbbbbb000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000bbbbbbbbbbbbbb00dddddddddddd0000000bbbbbbbb000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000bbbbbbbbbbbb000ddddddddddd00000000000bbbbbb00000000000000000000000000000000000
000000000000000000000000000000000000000000000000000bbbbbbbbbbb00ddddddddddddd0000000000000bbb00000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000bbbbbbbbb000dddddddddddddd0000000e000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000a000000bbbbbbbbb000ddddddddddd2222000000eeeeee0000000000000000000000000000000000000
000000000000000000000000000000000000000000000aa000000bbbbbbb0000dddddddc00222000000000eeeeeeeeeeee000000000000000000000000000000
000000000000000000000000000000000000000000000aaaa00000bbbbbb000ddddd0cc000220000000000eeeeeeeeeee0000000000000000000000000000000
000000000000000000000000000000000000000000000aaaaa0000bbbbb0000d0000000000000000000000eeeeeeeeee00000000000000000000000000000000
000000000000000000000000000000000000000000000aaaaaa0000bbbb080000000000000000000000000eeeeeeeeee00000000000000000000000000000000
00000000000000000000000000000000000000000000aaaaaaaa0000bb000888800000000000000000000009eeeeeee000000000000000000000000000000000
00000000000000000000000000000000000000000000aaaaaaaaa000bb000888888888800000000000999999eeeeee0000000000000000000000000000000000
00000000000000000000000000000000000000000000aaaaaaaaaa0000000888888888ff000000999999999eeeeee00000000000000000000000000000000000
00000000000000000000000000000000000000000000aaaaaaaaaaaa00000888888888f00999999999999990eeee000000000000000000000000000000000000
00000000000000000000000000000000000000000000aaaaaaaaaaaaa000008888888ff99999999999999990eee0000000000000000000000000000000000000
0000000000000000000000000000000000000000000aaaaaaaaaaaaaaa0000888888ff999999999999999900ee00000000000000000000000000000000000000
0000000000000000000000000000000000000000000aaaacaaaaaaa888888888688ff99999999999999999000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000aaaaccccccccc888881186666999999999999999999000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000aaaaacccccccc898111188666666999999994999990000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000aaaaaccccccccc99991111666669999999994449990000000000000000000000000000000000000000000
000000000000000000000000000000000000000000aaaaaaacccccccccccccccc666699999999994444490000000000000000000000000000000000000000000
000000000000000000000000000000000000000004aaaaaaacccccccccccccccb666999999999994444444000000000000000000000000000000000000000000
000000000000000000000000000000000000000004aaaaaaaaccccccccccccccb699999999999994444444444000000000000000000000000000000000000000
000000000000000000000000000000000000000044aaaaaaaacccccccccccccbb999999999999994444444444000000000000000000000000000000000000000
000000000000000000000000000000000000000444aaaaaaaacccccccc9ccc555550999999999994444444422222222222000000000000000000000000000000
00000000000000000000000000000000000000044aaaaaaaaaaccccccccccc555555559999999994444442222222222220000000000000000000000000000000
00000000000000000000000000000000000000444aaaaaaaaa0cccccccc9c5555555555999999994444422222222222200000000000000000000000000000000
00000000000000000000000000000000000004444aaaaaa00000cccccc7755555555550999999999444222222222222200000000000000000000000000000000
00000000000000000000000000000000000004444aaa44000000cccccc7755555555501199999999499222222222222000000000000000000000000000000000
00000000000000000000000000000000000044444444440000000cccc77775555555001119999999992222222222220000000000000000000000000000000000
00000000000000000000000000000000000444444444444000000ccc777775555550001111999999992222222222200000000000000000000000000000000000
000000000000000000000000000000000044444444444440000000cccc8cc5555500011111199999992222222222200000000000000000000000000000000000
000000000000000000000000000000000444444444444444000000cc888cc5550000010000099999922222222222000000000000000000000000000000000000
00000000000000000000000000000000044444444444444400000008888cc0500000000000009999922222222220000000000000000000000000000000000000
00000000000000000000000000000000444444444444444440000888888c00000000000000000999922222222200000000000000000000000000000000000000
00000000000000000000000000000004444444444444444440008888888000000000000000000099222222222000000000000000000000000000000000000000
00000000000000000000000000000000000000000004444444888888888000000000000000000000022222222000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000008888888888000000000000000000000022222220000000000000000000000000000000000000000
00000000000000000000000000000000000000000000008888888888888000000000000000000000022222200000000000000000000000000000000000000000
00000000000000000000000000000000000000000000008888888888888000000000000000000000002222000000000000000000000000000000000000000000
0000000000000000000000000000000a000000000000000088888888888000000000000000000000002222000000000000000000000000000000000000000000
0000000000000000000000000000000aa00000000000000000888888888000000000000000000000000220000000000000000000000000000000000000000000
000000000000000000000000000000aaaa0000000000000000008888888000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000aaaa0000000000000000000088888000000000000000002000000000000000000000000000000000000000000000000000
00000000000000000000000000000aaaaaa000000000000000000008888000000000000000002220000000000000000000000000000000000000000000000000
00000000000000000000000000000aaaaaaa00000000000000000000088000000000000000002222220000000000000000000000000000000000000000000000
00000000000000000000000000000aaaaaaaa0000000000000000000000000000000000000002222222220000000000000000000000000000000000000000000
0000000000000000000000000000aaaaaaaaaa000000000000000000000000000000000000002222222222220000000000000000000000000000000000000000
0000000000000000000000000000aaaaaaaaaa000000000000000000000000000000000000000222222222222220000000000000000000000000000000000000
000000000000000000000000000aaaaaaaaaaaa00000000000000000000000000000000000000222222222222222200000000000000000000000000000000000
000000000000000000000000000aaaaaaaaaaaaa0000000000000000000000000000000000000222222222222222222222000000000000000000000000000000
000000000000000000000000000aaaaaaaaaaaaaa000000000000000000000000000000000000222222222222222222220000000000000000000000000000000
00000000000000000000000000aaaaaaaaaaaaaaaa00000000000000000000000000000000000222222222222222222200000000000000000000000000000000
00000000000000000000000000aaaaaaaaaaaaaaaa00000000000010000000000000000000000222222222222222222000000000000000000000000000000000
00000000000000000000000000aaaaaaaaaaaaaaaaa000000001110b000000000000000000000022222222222222220000000000000000000000000000000000
0000000000000000000000000aaaaaaaaaaaaaaaaaaa000001111100bbbbbbbbbbbbbbbbbbbb0022222222222222200000000000000000000000000000000000
0000000000000000000000000aaaaaaaaaaaaaaaaaaaa00001111100bbbbbbbbbbbbbbbbbbbb0022222222222222f00000000000000000000000000000000000
000000000000000000000000aaaaaaaaaaaaaaaaaaaaaa00000111000bbbbbbbbbbbbbbbbbb00022222222222220000000000000000000000000000000000000
000000000000000000000000aaaaaaaaaaaaaaaaaaaaaaa0000011000bbbbbbbbbbbbbbbbb000022222222222200000000000000000000000000000000000000
00000000000000000000000aaaaaaaaaaaaaaaaaaaaaaaaa0000000000bbbbbbbbbbbbbbbb004002222222220000000000000000000000000000000000000000
00000000000000000000000aaaaaaaaaaaaaaaaaaaaaaaaa0000000000bbbbbbbbbbbbbbb0044402222222200000000000000000000000000000000000000000
00000000000000000000000aaaaaaaaaaaaaaaaaaaaaaaaaa0000000000bbbbbbbbbbbbbb0044402222222000700000000000000000000000000000000000000
0000000000000000000000aaaaaaaaaaaaaaaaaaaaaaaaaaaa000000000bbbbbbbbbbbbb00444442222220777700000000000000000000000000000000000000
0000000000000000000000aaaaaaaaaaaaaaaaaaaaaaaaaaaaa000000000bbbbbbbbbbbb00444442222277777000000000000000000000000000000000000000
000000000000000000000aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa00000000bbbbbbbbbbb004444442222777777000000000000000000000000000000000000000
000000000000000000000aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa000000000bbbbbbbbb0004444444277777777000000000000000000000000000000000000000
000000000000000000000aaaaaaaaaaaaaaaaaaaaaaaaa000000000000000bbbbbbbbb0044444444447777777000000000000000000000000000000000000000
00000000000000000000aaaaaaaaaaaaaaaaaaa00000000000000000000000bbbbbbb00044444444447777777000000000000000000000000000000000000000
00000000000000000000aaaaaaaaaaaa000000000000000000000000000000bbbbbb007444444444444777777000000000000000000000000000000000000000
00000000000000000000aaaaaa0000000000000000000000000000000000000bbbbb777444444444444477770000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000bbbb7774444444444444447770000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000777bb77774777777777777777770000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000077bb77777777777777777777770000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000077777777777777777777777770000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000007777777777777777777777770000000000000000000000000000000000000000

__sfx__
00010000000000205002050050500b2501d050170500c0500c0500a05009050080500705006050060500055001050010500055001050010500105000550010500105001050010500055000050000500055000050
00010000070501c350203501c35004300013000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
